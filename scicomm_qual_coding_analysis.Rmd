---
title: "SciComm Qualitative Coding Analysis"
author: "Victoria"
date: "4/30/2020"
output: html_document
---
```{r data setup}
library(tidyverse)
#import coded sentences
lines<-read.csv("~/Documents/projects/scicomm_analysis_Arik/data/treatment_reflections_sentences_coded.csv",na.strings=c("","NA"))
```

```{r collapse sentences into single reflections}
#collapse into one student reflection per week (ex: a student who did all 5 should have 5 lines in df total)

codes<-
lines %>%
  select(-X, -sis_login_id, -section, group, -reflection_text, -group) %>%
  mutate_all(~replace(., is.na(.), 0)) %>% #replace NA with 0 for sum purposes
 group_by( id, response_no) %>% summarise_all(funs(sum)) 
```

```{r create presence/absence df}
#take collapsed dataframe and convert to yes/no to presence/absence of each theme 
codes_binary <-
codes %>%
  group_by(id, response_no) %>%
   mutate_if(is.numeric, ~1 * (. != 0)) #create a binary y/n whether they expressed that theme 
```

```{r sample size}
#sample size of reflections  and students 
lines %>%
  group_by(response_no) %>%
  summarise(n_sentences = n(), 
            n_students = n_distinct(id)) #%>%
  #summarise_all(funs(sum))  #run this line to get column totals. 
```

```{r count presence of themes across reflection}
#count of each "theme" across reflections 
codes_binary %>%
  select(-id) %>%
  group_by(response_no)%>%
  mutate(n_students = n())%>%
  group_by(response_no, n_students) %>%
  summarise_all(funs(sum)) %>%
  select(-id)

#need to convert to %s as seen in previous dataframes 
themes_percents<- 
  codes_binary %>%
    group_by(response_no) %>%
    summarise(n = n(),
              perc_neutral = (sum(neutral, na.rm = T)/n)*100, 
              perc_class_metacog = (sum(class_metacog , na.rm = T)/n)*100,
              perc_gaps_knowledge = (sum(gaps_knowledge,  na.rm = T)/n)*100, 
              perc_comm_metacog =  (sum(comm_metacog,  na.rm = T)/n)*100,
              perc_contextualize = (sum(contextualize,  na.rm = T)/n)*100, 
              perc_positive = (sum(positive,  na.rm = T)/n)*100,
              perc_negative = (sum(negative,  na.rm = T)/n)*100) 

#theme percents in long form for ggplots. 
theme_perc_long <- 
  themes_percents %>%
  select(-n) %>%
  pivot_longer(-response_no, names_to = "theme", values_to = "percent") %>%
  mutate(theme = gsub( "perc_", "", as.character(theme))) %>% #get rid of perc_ header in theme names 
  mutate_if(is.character, as.factor) #convert back to factor 
```

```{r theme plots assgn 1 2 4 }
#view assignments 1, 2, 4 as bar graphs 

#across assignments: 
theme_perc_long %>%
  filter(response_no %in% c(1,2,4)) %>%
  ggplot(aes(x = theme, y = percent, fill = as.factor(response_no))) + 
  geom_col(position = position_dodge(0.9)) + 
  facet_wrap(~ response_no)

#across themes: 
theme_perc_long %>%
  filter(response_no %in% c(1,2,4)) %>%
  filter(theme != "neutral") %>%
  ggplot(aes(x = as.factor(response_no), y = percent, fill = theme)) + 
  geom_col(position = position_dodge(0.9), color = "black") + 
  ylim(0,100)+ 
  scale_x_discrete(labels = c("Teach", "Tweet", "Creative/Art"))+ 
  labs(x = NULL, y = "Percent of responses where theme was present") + 
  facet_wrap(~ theme) + 
  plot_design + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

```
```{r theme plot assgn 1 3 5}
#theme plot for numbers 1, 3, 5 (teaching assignment)
#across themes: 
theme_perc_long %>%
  filter(response_no %in% c(1,3,5)) %>%
  filter(theme != "neutral") %>%
  ggplot(aes(x = as.factor(response_no), y = percent, fill = theme)) + 
  geom_col(position = position_dodge(0.9), color = "black") + 
  ylim(0,100)+ 
  scale_x_discrete(labels = c("1st", "2nd", "3rd"))+ 
  labs(x = "Time students completed teaching assignment", y = "Percent of responses where theme was present") + 
  facet_wrap(~ theme) + 
  plot_design + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

```




